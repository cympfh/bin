#!/bin/bash

usage() {
  cat << HELP
Usage: tw-media [text] <image>

upload image (specified by url or local-path) with text.
text is optional.
HELP
}

if [ $# -lt 1 -o "_$1" == "_-h" -o "_$1" == "_-?" ]; then
  usage
  exit 0
fi

TEXT=$1
IMG=$2

if [ $# == 1 ]; then
  TEXT=''
  IMG=$1
fi

case $IMG in
  http*)
    LOC="/tmp/${IMG##*/}"
    wget --quiet -O $LOC $IMG
    ;;
  *)
    LOC=$IMG
    ;;
esac

twurl -X POST "/1.1/statuses/update_with_media.json" --file "$LOC" --file-field 'media[]' -d "status=$TEXT"
